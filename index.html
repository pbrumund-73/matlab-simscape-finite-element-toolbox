<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2020-06-05 ven. 15:47 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<title>Finite Element Model - Matlab Toolbox</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Dehaeze Thomas" />
<link rel="stylesheet" type="text/css" href="./css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="./css/readtheorg.css"/>
<script src="./js/jquery.min.js"></script>
<script src="./js/bootstrap.min.js"></script>
<script src="./js/jquery.stickytableheaders.min.js"></script>
<script src="./js/readtheorg.js"></script>
<script>MathJax = {
          tex: {
            tags: 'ams',
            macros: {bm: ["\\boldsymbol{#1}",1],}
            }
          };
          </script>
          <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="./index.html"> UP </a>
 |
 <a accesskey="H" href="./index.html"> HOME </a>
</div><div id="content">
<h1 class="title">Finite Element Model - Matlab Toolbox</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgae126db">1. Import Flexible Elements in Simscape using Component Mode Synthesis in Ansys</a>
<ul>
<li><a href="#org168d01e">1.1. Import Mass Matrix, Stiffness Matrix, and Interface Nodes Coordinates</a></li>
<li><a href="#org794ede7">1.2. Identification of the Dynamics</a></li>
</ul>
</li>
<li><a href="#org69000e9">2. Low Order Dynamical Model from a Finite Element Model</a>
<ul>
<li><a href="#org48e565c">2.1. Extract Eigenvalues and Eigenvectors</a></li>
<li><a href="#org922d8e0">2.2. Define Physical Inputs and Outputs</a></li>
<li><a href="#orgb62088a">2.3. Define Damping</a></li>
<li><a href="#orga59b873">2.4. All Modes Included in the Model</a></li>
<li><a href="#orgd0291c9">2.5. Simple mode truncation</a></li>
<li><a href="#org743b83f">2.6. Modes sorted by their DC gain</a></li>
<li><a href="#org051c557">2.7. Comparison</a></li>
<li><a href="#orgbbda618">2.8. Effect of the Individual Modes</a></li>
<li><a href="#org647472b">2.9. Non-Uniform Damping</a>
<ul>
<li><a href="#org7e608d2">2.9.1. Definition of the Damping</a></li>
<li><a href="#org310e9b1">2.9.2. State Space Model</a></li>
<li><a href="#orgc077501">2.9.3. Obtained Dynamics</a></li>
<li><a href="#org54cdcb1">2.9.4. Sort Modes based on their peak gain</a></li>
<li><a href="#org2671950">2.9.5. Model Reduction</a></li>
</ul>
</li>
<li><a href="#org40e2022">2.10. MIMO System</a>
<ul>
<li><a href="#org4b108c3">2.10.1. Inputs and Outputs</a></li>
<li><a href="#org55c7c79">2.10.2. Full Model</a></li>
<li><a href="#org871d08e">2.10.3. Balancing Reduction</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org441a9f9">3. Piezoelectric Stack Actuator / Sensor</a>
<ul>
<li><a href="#org7b3acba">3.1. Half Actuator / Half Sensor</a>
<ul>
<li><a href="#orgc2fddf7">3.1.1. Import Mass Matrix, Stiffness Matrix, and Interface Nodes Coordinates</a></li>
<li><a href="#org68e098c">3.1.2. Identification of the Dynamics</a></li>
</ul>
</li>
<li><a href="#orgcb62ecb">3.2. Mostly Actuator / Barely Sensor</a>
<ul>
<li><a href="#org7529b24">3.2.1. Import Mass Matrix, Stiffness Matrix, and Interface Nodes Coordinates</a></li>
<li><a href="#org2242317">3.2.2. Identification of the Dynamics</a></li>
</ul>
</li>
<li><a href="#org32499e1">3.3. Comparison</a></li>
</ul>
</li>
<li><a href="#orgad1278b">4. Functions</a>
<ul>
<li><a href="#orgf813fe5">4.1. <code>extractMatrix</code>: Extract Mass/Stiffness matrices</a>
<ul>
<li><a href="#orgba076c4">Function description</a></li>
<li><a href="#orge943fed">Optional Parameters</a></li>
<li><a href="#org410d920">Read the file</a></li>
<li><a href="#orgb3d0b23">Extract the Matrix</a></li>
</ul>
</li>
<li><a href="#orgd8ab9e5">4.2. <code>extractNodes</code>: Extract Nodes positions and Interfaces DoFs</a>
<ul>
<li><a href="#orgf6af842">Function description</a></li>
<li><a href="#orga3a7ebd">Optional Parameters</a></li>
<li><a href="#orgab0775d">Read the file</a></li>
<li><a href="#org345e246">Extract Nodes</a></li>
<li><a href="#orga76d8e5">Close the file</a></li>
<li><a href="#org5ff42b6">Get XYZ coordinates of the interface nodes</a></li>
</ul>
</li>
<li><a href="#org06bb2c4">4.3. <code>extractEigs</code>: Extract Eigen Values and Eigen Vectors</a>
<ul>
<li><a href="#orgedfe9c7">Function description</a></li>
<li><a href="#org8ea64e8">Optional Parameters</a></li>
<li><a href="#org33601e5">Open the file</a></li>
<li><a href="#orgec6ffd8">Extract Eigenvalues - Ansys</a></li>
<li><a href="#org740ae11">Close the file</a></li>
</ul>
</li>
<li><a href="#orgc35cf14">4.4. <code>normalizeEigs</code>: Normalize Eigen Vectors</a>
<ul>
<li><a href="#org2717179">Function description</a></li>
<li><a href="#org4b942e2">Optional Parameters</a></li>
<li><a href="#org555fc55">Normalize the Eigen Vectors - Mass Method</a></li>
<li><a href="#org95c5fc4">Normalize the Eigen Vectors - Unity Method</a></li>
</ul>
</li>
<li><a href="#orge3def56">4.5. <code>reductionInOut</code>: Reduce the Modal matrix to some nodes</a>
<ul>
<li><a href="#org847d6cc">Function description</a></li>
<li><a href="#orge05c8f3">Arguments</a></li>
<li><a href="#org5d8c89f">Size Reduction</a></li>
</ul>
</li>
<li><a href="#org11526ea">4.6. <code>computeModalDamping</code> - Compute the Damping</a>
<ul>
<li><a href="#orga87a578">Function description</a></li>
<li><a href="#org0903454">Arguments</a></li>
</ul>
</li>
<li><a href="#orgc3d6d78">4.7. <code>sortModes</code> - Sort Modes</a>
<ul>
<li><a href="#orgcc33983">Function description</a></li>
<li><a href="#org4a28ba6">Arguments</a></li>
</ul>
</li>
<li><a href="#orgeb5d867">4.8. <code>reduceModes</code> - Get Modes numbers for the reduced model</a>
<ul>
<li><a href="#org81ee148">Function description</a></li>
<li><a href="#org8e7aa47">Arguments</a></li>
</ul>
</li>
<li><a href="#org43899b2">4.9. <code>createStateSpaceModel</code> - Create the Reduced State Space Model</a>
<ul>
<li><a href="#org713e6f9">Function description</a></li>
<li><a href="#org4586188">Arguments</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>

<p>
This small toolbox provides a set of functions to help using flexible elements on Simscape from a Finite Element Software.
</p>

<p>
The functions are all described in section <a href="#org8c2c166">4</a>.
</p>

<p>
Few examples are provided in the following sections.
</p>

<div id="outline-container-orgae126db" class="outline-2">
<h2 id="orgae126db"><span class="section-number-2">1</span> Import Flexible Elements in Simscape using Component Mode Synthesis in Ansys</h2>
<div class="outline-text-2" id="text-1">
<p>
In this section, we wish to model a simple flexible cantilever beam using Simscape.
</p>

<p>
The cantilever beam is first defined in Ansys.
The reduced Mass and Stiffness matrices are then exported using the Component Mode Synthesis.
</p>

<p>
The coordinates of interface nodes (nodes where forces can be applied, displacements measured, and connections with other elements) are also exported.
</p>

<p>
First, these information are imported in Matlab, and then are used in Simscape to model the flexible element.
</p>
</div>

<div id="outline-container-org168d01e" class="outline-3">
<h3 id="org168d01e"><span class="section-number-3">1.1</span> Import Mass Matrix, Stiffness Matrix, and Interface Nodes Coordinates</h3>
<div class="outline-text-3" id="text-1-1">
<p>
We first extract the stiffness matrix.
</p>
<div class="org-src-container">
<pre class="src src-matlab">K = extractMatrix('cant_beam_K.txt');
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 1:</span> First 10x10 elements of the Stiffness matrix</caption>

<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">42000.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">-42000.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
</tr>

<tr>
<td class="org-right">0.0</td>
<td class="org-right">17.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">4200.0</td>
<td class="org-right">0.0</td>
<td class="org-right">-17.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
</tr>

<tr>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">17.0</td>
<td class="org-right">0.0</td>
<td class="org-right">-4200.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">-17.0</td>
<td class="org-right">0.0</td>
</tr>

<tr>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">230000.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">-230000.0</td>
</tr>

<tr>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">-4200.0</td>
<td class="org-right">0.0</td>
<td class="org-right">1400000.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">4200.0</td>
<td class="org-right">0.0</td>
</tr>

<tr>
<td class="org-right">0.0</td>
<td class="org-right">4200.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">1400000.0</td>
<td class="org-right">0.0</td>
<td class="org-right">-4200.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
</tr>

<tr>
<td class="org-right">-42000.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">84000.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
</tr>

<tr>
<td class="org-right">0.0</td>
<td class="org-right">-17.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">-4200.0</td>
<td class="org-right">0.0</td>
<td class="org-right">34.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
</tr>

<tr>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">-17.0</td>
<td class="org-right">0.0</td>
<td class="org-right">4200.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">34.0</td>
<td class="org-right">0.0</td>
</tr>

<tr>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">-230000.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">460000.0</td>
</tr>
</tbody>
</table>

<div class="org-src-container">
<pre class="src src-matlab">M = extractMatrix('cant_beam_M.txt');
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 2:</span> First 10x10 elements of the Mass matrix</caption>

<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">0.00013</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">6.5e-05</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
</tr>

<tr>
<td class="org-right">0.0</td>
<td class="org-right">0.00014</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.01</td>
<td class="org-right">0.0</td>
<td class="org-right">5e-05</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
</tr>

<tr>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.00014</td>
<td class="org-right">0.0</td>
<td class="org-right">-0.01</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">5e-05</td>
<td class="org-right">0.0</td>
</tr>

<tr>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0022</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0011</td>
</tr>

<tr>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">-0.01</td>
<td class="org-right">0.0</td>
<td class="org-right">0.93</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">-0.006</td>
<td class="org-right">0.0</td>
</tr>

<tr>
<td class="org-right">0.0</td>
<td class="org-right">0.01</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.93</td>
<td class="org-right">0.0</td>
<td class="org-right">0.006</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
</tr>

<tr>
<td class="org-right">6.5e-05</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.00026</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
</tr>

<tr>
<td class="org-right">0.0</td>
<td class="org-right">5e-05</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.006</td>
<td class="org-right">0.0</td>
<td class="org-right">0.00029</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
</tr>

<tr>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">5e-05</td>
<td class="org-right">0.0</td>
<td class="org-right">-0.006</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.00029</td>
<td class="org-right">0.0</td>
</tr>

<tr>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0011</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0043</td>
</tr>
</tbody>
</table>

<p>
Then, we extract the coordinates of the interface nodes.
</p>
<div class="org-src-container">
<pre class="src src-matlab">[int_xyz, int_i] = extractNodes('cant_beam.txt');
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 3:</span> Coordinates of the interface nodes</caption>

<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">Node Number</th>
<th scope="col" class="org-right">x</th>
<th scope="col" class="org-right">y</th>
<th scope="col" class="org-right">z</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">6</td>
<td class="org-right">500</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">22</td>
<td class="org-right">1000</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>
</tbody>
</table>

<p>
Using <code>K</code>, <code>M</code> and <code>int_xyz</code>, we can use the <code>Reduced Order Flexible Solid</code> simscape block.
</p>
</div>
</div>

<div id="outline-container-org794ede7" class="outline-3">
<h3 id="org794ede7"><span class="section-number-3">1.2</span> Identification of the Dynamics</h3>
<div class="outline-text-3" id="text-1-2">
<p>
The flexible element is imported using the <code>Reduced Order Flexible Solid</code> simscape block.
</p>

<p>
The beginning of the cantilever beam is fixed to the World frame, a force actuator is added in the z direction on the middle node, and a z-displacement sensor is added at the end of the beam.
</p>

<p>
The dynamics is identified from the applied force to the measured displacement (Figure <a href="#org4137da2">1</a>).
</p>

<div class="org-src-container">
<pre class="src src-matlab">%% Name of the Simulink File
mdl = 'cant_beam';

%% Input/Output definition
clear io; io_i = 1;
io(io_i) = linio([mdl, '/F'], 1, 'openinput');  io_i = io_i + 1;
io(io_i) = linio([mdl, '/z'], 1, 'openoutput'); io_i = io_i + 1;

G = linearize(mdl, io);
</pre>
</div>


<div id="org4137da2" class="figure">
<p><img src="figs/cant_beam_frf.png" alt="cant_beam_frf.png" />
</p>
<p><span class="figure-number">Figure 1: </span>Identify transfer function from a vertical force applied at the middle point of the cantilever beam to its vertical displacement</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org69000e9" class="outline-2">
<h2 id="org69000e9"><span class="section-number-2">2</span> Low Order Dynamical Model from a Finite Element Model</h2>
<div class="outline-text-2" id="text-2">
<p>
Most of the example presented in this section are taken from <a class='org-ref-reference' href="#hatch00_vibrat_matlab_ansys">hatch00_vibrat_matlab_ansys</a>.
</p>

<p>
The goal is to obtain a low order model from a Finite Element Model.
</p>

<p>
We suppose here that the eigenvalues and eigenvectors are exported using a Finite Element software.
</p>

<p>
Once the eigenvalues and eigenvectors are imported, one should choose the inputs and outputs nodes (e.g. where the forces and the displacements are measured) to first reduce the number of eigenvectors.
</p>

<p>
Damping can then be added to each.
</p>

<p>
Then, in order to reduce the size of the model, only few modes are included in the model.
The selection of the modes to keep in the model can be based on the &ldquo;dc gain&rdquo; or &ldquo;peak gain&rdquo; method depending on the damping.
</p>

<p>
Finally, the full model and reduced models are compared.
</p>
</div>

<div id="outline-container-org48e565c" class="outline-3">
<h3 id="org48e565c"><span class="section-number-3">2.1</span> Extract Eigenvalues and Eigenvectors</h3>
<div class="outline-text-3" id="text-2-1">
<p>
The eigenvalues and eigenvectors are extracted.
</p>
<div class="org-src-container">
<pre class="src src-matlab">[xn, f0] = extractEigs('cantbeam30bl.eig', 'dirs', [1 0 0 0 0 0]');

n_nodes = size(xn, 1);
n_modes = size(xn, 2);
</pre>
</div>
</div>
</div>

<div id="outline-container-org922d8e0" class="outline-3">
<h3 id="org922d8e0"><span class="section-number-3">2.2</span> Define Physical Inputs and Outputs</h3>
<div class="outline-text-3" id="text-2-2">
<p>
First, define the node numbers corresponding to the inputs and outputs
</p>
<div class="org-src-container">
<pre class="src src-matlab">i_input = 14; % middle of the beam
i_output = 29; % end of the beam
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb62088a" class="outline-3">
<h3 id="orgb62088a"><span class="section-number-3">2.3</span> Define Damping</h3>
<div class="outline-text-3" id="text-2-3">
<p>
We here use uniform damping.
</p>
<div class="org-src-container">
<pre class="src src-matlab">xi = 0.01;
</pre>
</div>
</div>
</div>

<div id="outline-container-orga59b873" class="outline-3">
<h3 id="orga59b873"><span class="section-number-3">2.4</span> All Modes Included in the Model</h3>
<div class="outline-text-3" id="text-2-4">
<p>
The state space matrices are created by &ldquo;inspection&rdquo;.
Here, we include all the modes.
</p>


<p>
System Matrix - A
</p>
<div class="org-src-container">
<pre class="src src-matlab">Adiag = zeros(2*n_modes,1);
Adiag(2:2:end) = -2*xi.*(2*pi*f0);

Adiagsup = zeros(2*n_modes-1,1);
Adiagsup(1:2:end) = 1;

Adiaginf = zeros(2*n_modes-1,1);
Adiaginf(1:2:end) = -(2*pi*f0).^2;

A = diag(Adiag) + diag(Adiagsup, 1) + diag(Adiaginf, -1);
</pre>
</div>

<p>
System Matrix - B
</p>
<div class="org-src-container">
<pre class="src src-matlab">B = zeros(2*n_modes, length(i_input));

for i = 1:length(i_input)
    % Physical Coordinates
    Fp = zeros(n_nodes, 1);
    Fp(i_input(i)) = 1;

    B(2:2:end, i) = xn'*Fp;
end
</pre>
</div>

<p>
System Matrix - C
</p>
<div class="org-src-container">
<pre class="src src-matlab">C = zeros(length(i_output), 2*n_modes);
C(:, 1:2:end) = xn(i_output, :);
</pre>
</div>

<p>
System Matrix - D
</p>
<div class="org-src-container">
<pre class="src src-matlab">D = zeros(length(i_output), length(i_input));
</pre>
</div>

<p>
State Space Model
</p>
<div class="org-src-container">
<pre class="src src-matlab">G_f = ss(A, B, C, D);
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd0291c9" class="outline-3">
<h3 id="orgd0291c9"><span class="section-number-3">2.5</span> Simple mode truncation</h3>
<div class="outline-text-3" id="text-2-5">
<p>
Let see what happens is we simply truncate the number of modes (keeping only the low frequency modes).
</p>

<p>
The frequency of the modes are shown in Figure <a href="#org05368a7">2</a>.
</p>

<p>
The DC gain of each mode is shown in Figure <a href="#org063560a">3</a>.
</p>


<div id="org05368a7" class="figure">
<p><img src="figs/hatch00_cant_beam_modes_freq.png" alt="hatch00_cant_beam_modes_freq.png" />
</p>
<p><span class="figure-number">Figure 2: </span>Frequency of the modes</p>
</div>


<div id="org063560a" class="figure">
<p><img src="figs/hatch00_cant_beam_unsorted_dc_gains.png" alt="hatch00_cant_beam_unsorted_dc_gains.png" />
</p>
<p><span class="figure-number">Figure 3: </span>Unsorted DC Gains</p>
</div>

<p>
Let&rsquo;s keep only the first 10 modes.
</p>
<div class="org-src-container">
<pre class="src src-matlab">m_max = 10;
xn_t = xn(:, 1:m_max);
f0_t = f0(1:m_max);
</pre>
</div>

<p>
And create the state space model with the kept modes:
</p>
</div>
</div>
<div id="outline-container-org743b83f" class="outline-3">
<h3 id="org743b83f"><span class="section-number-3">2.6</span> Modes sorted by their DC gain</h3>
<div class="outline-text-3" id="text-2-6">
<p>
Let&rsquo;s sort the modes by their DC gains and plot their sorted DC gains (Figure <a href="#org5fa5127">4</a>).
</p>

<div class="org-src-container">
<pre class="src src-matlab">dc_gain = abs(xn(i_input, :).*xn(i_output, :))./(2*pi*f0).^2;

[dc_gain_sort, index_sort] = sort(dc_gain, 'descend');
</pre>
</div>


<div id="org5fa5127" class="figure">
<p><img src="figs/hatch00_cant_beam_sorted_dc_gains.png" alt="hatch00_cant_beam_sorted_dc_gains.png" />
</p>
<p><span class="figure-number">Figure 4: </span>Sorted DC Gains</p>
</div>

<p>
Let&rsquo;s keep only the first 10 <b>sorted</b> modes.
</p>
<div class="org-src-container">
<pre class="src src-matlab">m_max = 10;

xn_s = xn(:, index_sort(1:m_max));
f0_s = f0(index_sort(1:m_max));
</pre>
</div>

<p>
And create the state space model with the kept modes:
</p>
<div class="org-src-container">
<pre class="src src-matlab">G_s = ss(A, B, C, D);
</pre>
</div>
</div>
</div>

<div id="outline-container-org051c557" class="outline-3">
<h3 id="org051c557"><span class="section-number-3">2.7</span> Comparison</h3>
<div class="outline-text-3" id="text-2-7">
<p>
The following models are compared on Figure <a href="#org43e0207">5</a>:
</p>
<ul class="org-ul">
<li>full model containing all the modes</li>
<li>the truncated model containing only the low frequency modes</li>
<li>the model where modes are sorted based on DC gain before selection</li>
</ul>

<p>
One can see that with the same number of modes, the sorted model gives much better results than the truncated one.
</p>


<div id="org43e0207" class="figure">
<p><img src="figs/cant_beam_comp_reduc_techniques.png" alt="cant_beam_comp_reduc_techniques.png" />
</p>
<p><span class="figure-number">Figure 5: </span>Comparison of the reduction techniques</p>
</div>
</div>
</div>

<div id="outline-container-orgbbda618" class="outline-3">
<h3 id="orgbbda618"><span class="section-number-3">2.8</span> Effect of the Individual Modes</h3>
<div class="outline-text-3" id="text-2-8">
<p>
To see why it is better to sort the modes prior mode reduction, we can look at the contribution of the individual modes as shown in Figure <a href="#orge11441d">6</a>.
</p>

<p>
One can see that some modes have no effect on the dynamics for the selected inputs and outputs.
</p>

<div class="org-src-container">
<pre class="src src-matlab">freqs = logspace(0, 4, 1000);

figure;
hold on;
for mode_i = 1:10
    A = zeros(2);
    A(2,2) = -2*xi.*(2*pi*f0(mode_i));
    A(1,2) = 1;
    A(2,1) = -(2*pi*f0(mode_i)).^2;

    B = [0; xn(i_input, mode_i)'];

    C = [xn(i_output, mode_i), 0];

    D = zeros(length(i_output), length(i_input));

    plot(freqs, abs(squeeze(freqresp(ss(A,B,C,D), freqs, 'Hz'))), ...
         'DisplayName', sprintf('Mode %i', mode_i));
end
plot(freqs, abs(squeeze(freqresp(G_f, freqs, 'Hz'))), 'k--', ...
     'DisplayName', 'Full');
set(gca, 'XScale', 'log'); set(gca, 'YScale', 'log');
ylabel('Amplitude'); xlabel('Frequency [Hz]');
ylim([1e-9, 1e2]);
legend('location', 'southwest');
</pre>
</div>


<div id="orge11441d" class="figure">
<p><img src="figs/cant_beam_individial_modes.png" alt="cant_beam_individial_modes.png" />
</p>
<p><span class="figure-number">Figure 6: </span>Contribution of the individual modes on the dynamics</p>
</div>
</div>
</div>

<div id="outline-container-org647472b" class="outline-3">
<h3 id="org647472b"><span class="section-number-3">2.9</span> Non-Uniform Damping</h3>
<div class="outline-text-3" id="text-2-9">
</div>
<div id="outline-container-org7e608d2" class="outline-4">
<h4 id="org7e608d2"><span class="section-number-4">2.9.1</span> Definition of the Damping</h4>
<div class="outline-text-4" id="text-2-9-1">
<p>
Let&rsquo;s say we want to use Rayleigh damping:
</p>
\begin{equation}
  \xi_i = \frac{a + b \omega_i^2}{\omega_i}
\end{equation}

<p>
We define the parameters on Matlab:
</p>
<div class="org-src-container">
<pre class="src src-matlab">a = 1e-2;
b = 1e-6;
xi = (a + b * (2*pi*f0).^2)./(2*pi*f0);
</pre>
</div>
</div>
</div>

<div id="outline-container-org310e9b1" class="outline-4">
<h4 id="org310e9b1"><span class="section-number-4">2.9.2</span> State Space Model</h4>
<div class="outline-text-4" id="text-2-9-2">
<p>
And we can create the state space model.
</p>

<p>
System Matrix - A
</p>
<div class="org-src-container">
<pre class="src src-matlab">Adiag = zeros(2*n_modes,1);
Adiag(2:2:end) = -2*xi.*(2*pi*f0);

Adiagsup = zeros(2*n_modes-1,1);
Adiagsup(1:2:end) = 1;

Adiaginf = zeros(2*n_modes-1,1);
Adiaginf(1:2:end) = -(2*pi*f0).^2;

A = diag(Adiag) + diag(Adiagsup, 1) + diag(Adiaginf, -1);
</pre>
</div>

<p>
System Matrix - B
</p>
<div class="org-src-container">
<pre class="src src-matlab">B = zeros(2*n_modes, length(i_input));

for i = 1:length(i_input)
    % Physical Coordinates
    Fp = zeros(n_nodes, 1);
    Fp(i_input(i)) = 1;

    B(2:2:end, i) = xn'*Fp;
end
</pre>
</div>

<p>
System Matrix - C
</p>
<div class="org-src-container">
<pre class="src src-matlab">C = zeros(length(i_output), 2*n_modes);
C(:, 1:2:end) = xn(i_output, :);
</pre>
</div>

<p>
System Matrix - D
</p>
<div class="org-src-container">
<pre class="src src-matlab">D = zeros(length(i_output), length(i_input));
</pre>
</div>

<p>
State Space Model
</p>
<div class="org-src-container">
<pre class="src src-matlab">G_d = ss(A, B, C, D);
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc077501" class="outline-4">
<h4 id="orgc077501"><span class="section-number-4">2.9.3</span> Obtained Dynamics</h4>
<div class="outline-text-4" id="text-2-9-3">
<p>
And we compare the obtained dynamics when using Uniform Damping (Figure <a href="#org4f86802">7</a>).
</p>


<div id="org4f86802" class="figure">
<p><img src="figs/cant_beam_comp_unif_non_unif_damp.png" alt="cant_beam_comp_unif_non_unif_damp.png" />
</p>
<p><span class="figure-number">Figure 7: </span>Comparison of the obtained dynamics with uniform damping and non-uniform damping</p>
</div>
</div>
</div>

<div id="outline-container-org54cdcb1" class="outline-4">
<h4 id="org54cdcb1"><span class="section-number-4">2.9.4</span> Sort Modes based on their peak gain</h4>
<div class="outline-text-4" id="text-2-9-4">
<p>
The modes are sorted by their peak gain.
The obtained sorted peak gains for each mode are shown in figure <a href="#org252a201">8</a>.
</p>

<div class="org-src-container">
<pre class="src src-matlab">dc_gain = abs(xn(i_input, :).*xn(i_output, :))./(2*pi*f0).^2;
peak_gain = dc_gain./xi;

[peak_gain_sort, index_sort] = sort(peak_gain, 'descend');
</pre>
</div>


<div id="org252a201" class="figure">
<p><img src="figs/cant_beam_peak_gains_sorted.png" alt="cant_beam_peak_gains_sorted.png" />
</p>
<p><span class="figure-number">Figure 8: </span>Sorted Peak Gains</p>
</div>
</div>
</div>

<div id="outline-container-org2671950" class="outline-4">
<h4 id="org2671950"><span class="section-number-4">2.9.5</span> Model Reduction</h4>
<div class="outline-text-4" id="text-2-9-5">
<p>
Let&rsquo;s keep only the first 10 <b>sorted</b> modes.
</p>

<div class="org-src-container">
<pre class="src src-matlab">m_max = 10;

xn_s = xn(:, index_sort(1:m_max));
f0_s = f0(index_sort(1:m_max));
xi_s = xi(index_sort(1:m_max));
</pre>
</div>

<p>
And we create the state space matrices.
</p>

<div class="org-src-container">
<pre class="src src-matlab">Adiag = zeros(2*m_max,1);
Adiag(2:2:end) = -2*xi_s.*(2*pi*f0_s);

Adiagsup = zeros(2*m_max-1,1);
Adiagsup(1:2:end) = 1;

Adiaginf = zeros(2*m_max-1,1);
Adiaginf(1:2:end) = -(2*pi*f0_s).^2;

A = diag(Adiag) + diag(Adiagsup, 1) + diag(Adiaginf, -1);
</pre>
</div>

<div class="org-src-container">
<pre class="src src-matlab">B = zeros(2*m_max, length(i_input));

for i = 1:length(i_input)
    % Physical Coordinates
    Fp = zeros(n_nodes, 1);
    Fp(i_input(i)) = 1;

    B(2:2:end, i) = xn_s'*Fp;
end
</pre>
</div>

<div class="org-src-container">
<pre class="src src-matlab">C = zeros(length(i_output), 2*m_max);
C(:, 1:2:end) = xn_s(i_output, :);
</pre>
</div>

<div class="org-src-container">
<pre class="src src-matlab">D = zeros(length(i_output), length(i_input));
</pre>
</div>

<p>
And finally the reduced State Space Model is created and compared with the full model in Figure <a href="#org988436f">9</a>.
</p>
<div class="org-src-container">
<pre class="src src-matlab">G_p = ss(A, B, C, D);
</pre>
</div>


<div id="org988436f" class="figure">
<p><img src="figs/cant_beam_non_uniform_damp_reduced_dynamics.png" alt="cant_beam_non_uniform_damp_reduced_dynamics.png" />
</p>
<p><span class="figure-number">Figure 9: </span>Comparison of the full and reduced model for the non-uniform damping case</p>
</div>
</div>
</div>
</div>


<div id="outline-container-org40e2022" class="outline-3">
<h3 id="org40e2022"><span class="section-number-3">2.10</span> MIMO System</h3>
<div class="outline-text-3" id="text-2-10">
<p>
When using multiple inputs and multiple outputs, one cannot simply choose the modes to keep based on their gains because this gain depends on the inputs and outputs chosen.
</p>

<p>
In such case, <b>balancing reduction</b> should be used.
</p>
</div>

<div id="outline-container-org4b108c3" class="outline-4">
<h4 id="org4b108c3"><span class="section-number-4">2.10.1</span> Inputs and Outputs</h4>
<div class="outline-text-4" id="text-2-10-1">
<p>
Let&rsquo;s choose two inputs and two outputs.
</p>
<div class="org-src-container">
<pre class="src src-matlab">i_input = [14, 31];
i_output = [14, 31];
</pre>
</div>
</div>
</div>

<div id="outline-container-org55c7c79" class="outline-4">
<h4 id="org55c7c79"><span class="section-number-4">2.10.2</span> Full Model</h4>
<div class="outline-text-4" id="text-2-10-2">
<p>
The state space matrices are created by inspection.
</p>

<div class="org-src-container">
<pre class="src src-matlab">Adiag = zeros(2*n_modes,1);
Adiag(2:2:end) = -2*xi.*(2*pi*f0);

Adiagsup = zeros(2*n_modes-1,1);
Adiagsup(1:2:end) = 1;

Adiaginf = zeros(2*n_modes-1,1);
Adiaginf(1:2:end) = -(2*pi*f0).^2;

A = diag(Adiag) + diag(Adiagsup, 1) + diag(Adiaginf, -1);
</pre>
</div>

<div class="org-src-container">
<pre class="src src-matlab">B = zeros(2*n_modes, length(i_input));

for i = 1:length(i_input)
    % Physical Coordinates
    Fp = zeros(n_nodes, 1);
    Fp(i_input(i)) = 1;

    B(2:2:end, i) = xn'*Fp;
end
</pre>
</div>

<div class="org-src-container">
<pre class="src src-matlab">C = zeros(length(i_output), 2*n_modes);
C(:, 1:2:end) = xn(i_output, :);
</pre>
</div>

<div class="org-src-container">
<pre class="src src-matlab">D = zeros(length(i_output), length(i_input));
</pre>
</div>

<p>
And the State Space Model is created.
</p>
<div class="org-src-container">
<pre class="src src-matlab">G_m = ss(A, B, C, D);
</pre>
</div>
</div>
</div>

<div id="outline-container-org871d08e" class="outline-4">
<h4 id="org871d08e"><span class="section-number-4">2.10.3</span> Balancing Reduction</h4>
<div class="outline-text-4" id="text-2-10-3">
<p>
First, we have to make sure that the rigid body mode is not included in the system (here it is not).
</p>

<p>
Then, we compute the <b>controllability and observability gramians</b>.
</p>
<div class="org-src-container">
<pre class="src src-matlab">wc = gram(G_m, 'c');
wo = gram(G_m, 'o');
</pre>
</div>

<p>
And we plot the diagonal terms of the controllability and observability gramians (Figure <a href="#orgf669f1d">10</a>).
The states representing the position and velocity are separated.
</p>


<div id="orgf669f1d" class="figure">
<p><img src="figs/cant_beam_gramians.png" alt="cant_beam_gramians.png" />
</p>
<p><span class="figure-number">Figure 10: </span>Diagonal values of the Observability and Controllability Gramians</p>
</div>

<p>
We use <code>balreal</code> to rank oscillatory states.
</p>
<blockquote>
<p>
[SYSB,G] = BALREAL(SYS) computes a balanced state-space realization for
the stable portion of the linear system SYS. For stable systems, SYSB
is an equivalent realization for which the controllability and
observability Gramians are equal and diagonal, their diagonal entries
forming the vector G of Hankel singular values. Small entries in G
indicate states that can be removed to simplify the model (use MODRED
to reduce the model order).
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-matlab">[G_b, G, T, Ti] = balreal(G_m);
</pre>
</div>

<p>
The diagonal values of the two gramians are shown in Figure <a href="#orgc3264f4">11</a>.
</p>


<div id="orgc3264f4" class="figure">
<p><img src="figs/cant_beam_gramian_balanced.png" alt="cant_beam_gramian_balanced.png" />
</p>
<p><span class="figure-number">Figure 11: </span>Sorted values of the Gramian of the balanced realization</p>
</div>

<p>
Now we can choose the number of states to keep.
</p>
<div class="org-src-container">
<pre class="src src-matlab">n_states_b = 10;
</pre>
</div>

<p>
We now use <code>modred</code> to define reduced order oscillatory system using <code>mathdc</code> or <code>truncate</code> option.
</p>
<blockquote>
<p>
MODRED  Model simplification by state elimination.
</p>

<p>
RSYS = MODRED(SYS,ELIM) simplifies the state-space model SYS by
discarding the states specified in the vector ELIM. The full state
vector X is partitioned as X = [X1;X2] where Xr=X1 is the reduced
state vector and X2 is discarded.
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-matlab">G_br = modred(G_b, n_states_b+1:size(A,1), 'truncate');
</pre>
</div>

<p>
If needed, the rigid body mode should be added to the reduced system.
</p>

<p>
And other option is to specify the minimum value of the gramians diagonal elements for the modes to keep.
</p>
<div class="org-src-container">
<pre class="src src-matlab">G_min = 1e-4;
G_br = modred(G_b, G&lt;G_min, 'truncate');
</pre>
</div>

<p>
The obtained reduced dynamics is shown in Figure <a href="#org5a99391">12</a>.
</p>


<div id="org5a99391" class="figure">
<p><img src="figs/cant_beam_mimo_reduction.png" alt="cant_beam_mimo_reduction.png" />
</p>
<p><span class="figure-number">Figure 12: </span>Balanced reduction on the MIMO system</p>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org441a9f9" class="outline-2">
<h2 id="org441a9f9"><span class="section-number-2">3</span> Piezoelectric Stack Actuator / Sensor</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-org7b3acba" class="outline-3">
<h3 id="org7b3acba"><span class="section-number-3">3.1</span> Half Actuator / Half Sensor</h3>
<div class="outline-text-3" id="text-3-1">
</div>
<div id="outline-container-orgc2fddf7" class="outline-4">
<h4 id="orgc2fddf7"><span class="section-number-4">3.1.1</span> Import Mass Matrix, Stiffness Matrix, and Interface Nodes Coordinates</h4>
<div class="outline-text-4" id="text-3-1-1">
<p>
We first extract the stiffness and mass matrices.
</p>
<div class="org-src-container">
<pre class="src src-matlab">K = extractMatrix('piezo_stack_half_K.txt');
M = extractMatrix('piezo_stack_half_M.txt');
</pre>
</div>

<p>
Then, we extract the coordinates of the interface nodes.
</p>
<div class="org-src-container">
<pre class="src src-matlab">[int_xyz, int_i, n_xyz, n_i, nodes] = extractNodes('piezo_stack_half.txt');
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-left">Total number of Nodes</td>
<td class="org-right">1404</td>
</tr>

<tr>
<td class="org-left">Number of interface Nodes</td>
<td class="org-right">3</td>
</tr>

<tr>
<td class="org-left">Number of Modes</td>
<td class="org-right">186</td>
</tr>

<tr>
<td class="org-left">Size of M and K matrices</td>
<td class="org-right">204</td>
</tr>
</tbody>
</table>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 4:</span> Coordinates of the interface nodes</caption>

<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">Node Number</th>
<th scope="col" class="org-right">x [m]</th>
<th scope="col" class="org-right">y [m]</th>
<th scope="col" class="org-right">z [m]</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">1402.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
</tr>

<tr>
<td class="org-right">1403.0</td>
<td class="org-right">0.035</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
</tr>

<tr>
<td class="org-right">1404.0</td>
<td class="org-right">0.07</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
</tr>
</tbody>
</table>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 5:</span> First 10x10 elements of the Stiffness matrix</caption>

<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">200000000.0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">-200000000.0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-right">10000000.0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">200000.0</td>
<td class="org-right">0</td>
<td class="org-right">-10000000.0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">10000000.0</td>
<td class="org-right">8e-06</td>
<td class="org-right">-200000.0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">-10000000.0</td>
<td class="org-right">4e-06</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">8e-06</td>
<td class="org-right">1000.0</td>
<td class="org-right">-4e-08</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">4e-06</td>
<td class="org-right">-1000.0</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">-200000.0</td>
<td class="org-right">-4e-08</td>
<td class="org-right">6000.0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">200000.0</td>
<td class="org-right">-3e-08</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-right">200000.0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">6000.0</td>
<td class="org-right">0</td>
<td class="org-right">-200000.0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">-200000000.0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">400000000.0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-right">-10000000.0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">-200000.0</td>
<td class="org-right">0</td>
<td class="org-right">30000000.0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">-10000000.0</td>
<td class="org-right">4e-06</td>
<td class="org-right">200000.0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">30000000.0</td>
<td class="org-right">2e-05</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">4e-06</td>
<td class="org-right">-1000.0</td>
<td class="org-right">-3e-08</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">2e-05</td>
<td class="org-right">2000.0</td>
</tr>
</tbody>
</table>


<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 6:</span> First 10x10 elements of the Mass matrix</caption>

<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">0.009</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0.005</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-right">0.01</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">5e-05</td>
<td class="org-right">0</td>
<td class="org-right">0.004</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0.01</td>
<td class="org-right">-6e-16</td>
<td class="org-right">-5e-05</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0.004</td>
<td class="org-right">-5e-16</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">-6e-16</td>
<td class="org-right">2e-07</td>
<td class="org-right">4e-18</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">-5e-16</td>
<td class="org-right">8e-08</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">-5e-05</td>
<td class="org-right">4e-18</td>
<td class="org-right">3e-07</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">-3e-05</td>
<td class="org-right">4e-18</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-right">5e-05</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">3e-07</td>
<td class="org-right">0</td>
<td class="org-right">3e-05</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">0.005</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0.02</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-right">0.004</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">3e-05</td>
<td class="org-right">0</td>
<td class="org-right">0.02</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0.004</td>
<td class="org-right">-5e-16</td>
<td class="org-right">-3e-05</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0.02</td>
<td class="org-right">-1e-15</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">-5e-16</td>
<td class="org-right">8e-08</td>
<td class="org-right">4e-18</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">-1e-15</td>
<td class="org-right">3e-07</td>
</tr>
</tbody>
</table>

<p>
Using <code>K</code>, <code>M</code> and <code>int_xyz</code>, we can use the <code>Reduced Order Flexible Solid</code> simscape block.
</p>
</div>
</div>

<div id="outline-container-org68e098c" class="outline-4">
<h4 id="org68e098c"><span class="section-number-4">3.1.2</span> Identification of the Dynamics</h4>
<div class="outline-text-4" id="text-3-1-2">
<p>
The flexible element is imported using the <code>Reduced Order Flexible Solid</code> simscape block.
</p>

<p>
To model the actuator, an <code>Internal Force</code> block is added between the first and second nodes.
To model the sensors, a <code>Relative Motion Sensor</code> block is added between the second and the third nodes.
</p>

<p>
Two masses are fixed at the ends of the piezo-electric stack actuator.
</p>

<p>
We first set the mass to be zero.
</p>
<div class="org-src-container">
<pre class="src src-matlab">m = 0;
</pre>
</div>

<p>
The dynamics is identified from the applied force to the measured relative displacement.
</p>

<div class="org-src-container">
<pre class="src src-matlab">%% Name of the Simulink File
mdl = 'piezo_stack';

%% Input/Output definition
clear io; io_i = 1;
io(io_i) = linio([mdl, '/F'], 1, 'openinput');  io_i = io_i + 1;
io(io_i) = linio([mdl, '/x'], 1, 'openoutput'); io_i = io_i + 1;

Gh = linearize(mdl, io);
</pre>
</div>

<p>
Then, we add 1Kg of mass:
</p>
<div class="org-src-container">
<pre class="src src-matlab">m = 1;
</pre>
</div>

<p>
And the dynamics is identified.
</p>

<p>
The two identified dynamics are compared in Figure <a href="#org59f479c">13</a>.
</p>


<div id="org59f479c" class="figure">
<p><img src="figs/piezo_stack_half_frf.png" alt="piezo_stack_half_frf.png" />
</p>
<p><span class="figure-number">Figure 13: </span>Identify transfer function from a vertical force applied at the middle point of the cantilever beam to its vertical displacement</p>
</div>
</div>
</div>
</div>

<div id="outline-container-orgcb62ecb" class="outline-3">
<h3 id="orgcb62ecb"><span class="section-number-3">3.2</span> Mostly Actuator / Barely Sensor</h3>
<div class="outline-text-3" id="text-3-2">
</div>
<div id="outline-container-org7529b24" class="outline-4">
<h4 id="org7529b24"><span class="section-number-4">3.2.1</span> Import Mass Matrix, Stiffness Matrix, and Interface Nodes Coordinates</h4>
<div class="outline-text-4" id="text-3-2-1">
<p>
We first extract the stiffness and mass matrices.
</p>
<div class="org-src-container">
<pre class="src src-matlab">K = extractMatrix('piezo_stack_actuator_K.txt');
M = extractMatrix('piezo_stack_actuator_M.txt');
</pre>
</div>

<p>
Then, we extract the coordinates of the interface nodes.
</p>
<div class="org-src-container">
<pre class="src src-matlab">[int_xyz, int_i, n_xyz, n_i, nodes] = extractNodes('piezo_stack_actuator.txt');
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-left">Total number of Nodes</td>
<td class="org-right">1401</td>
</tr>

<tr>
<td class="org-left">Number of interface Nodes</td>
<td class="org-right">3</td>
</tr>

<tr>
<td class="org-left">Number of Modes</td>
<td class="org-right">30</td>
</tr>

<tr>
<td class="org-left">Size of M and K matrices</td>
<td class="org-right">48</td>
</tr>
</tbody>
</table>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 7:</span> Coordinates of the interface nodes</caption>

<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">Node Number</th>
<th scope="col" class="org-right">x [m]</th>
<th scope="col" class="org-right">y [m]</th>
<th scope="col" class="org-right">z [m]</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">1.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
</tr>

<tr>
<td class="org-right">2.0</td>
<td class="org-right">0.06</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
</tr>

<tr>
<td class="org-right">3.0</td>
<td class="org-right">0.07</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
</tr>
</tbody>
</table>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 8:</span> First 10x10 elements of the Stiffness matrix</caption>

<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">110000000.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">-110000000.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
</tr>

<tr>
<td class="org-right">0.0</td>
<td class="org-right">2600000.0</td>
<td class="org-right">0.0</td>
<td class="org-right">1.3e-08</td>
<td class="org-right">0.0</td>
<td class="org-right">82000.0</td>
<td class="org-right">0.0</td>
<td class="org-right">-2600000.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
</tr>

<tr>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">2600000.0</td>
<td class="org-right">1.5e-05</td>
<td class="org-right">-82000.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">-2600000.0</td>
<td class="org-right">6.5e-06</td>
</tr>

<tr>
<td class="org-right">0.0</td>
<td class="org-right">1.3e-08</td>
<td class="org-right">1.5e-05</td>
<td class="org-right">610.0</td>
<td class="org-right">-1.3e-07</td>
<td class="org-right">6.3e-13</td>
<td class="org-right">0.0</td>
<td class="org-right">7.8e-13</td>
<td class="org-right">6.5e-06</td>
<td class="org-right">-610.0</td>
</tr>

<tr>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">-82000.0</td>
<td class="org-right">-1.3e-07</td>
<td class="org-right">3500.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">82000.0</td>
<td class="org-right">-9.2e-08</td>
</tr>

<tr>
<td class="org-right">0.0</td>
<td class="org-right">82000.0</td>
<td class="org-right">0.0</td>
<td class="org-right">6.3e-13</td>
<td class="org-right">0.0</td>
<td class="org-right">3500.0</td>
<td class="org-right">0.0</td>
<td class="org-right">-82000.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
</tr>

<tr>
<td class="org-right">-110000000.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">1100000000.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
</tr>

<tr>
<td class="org-right">0.0</td>
<td class="org-right">-2600000.0</td>
<td class="org-right">0.0</td>
<td class="org-right">7.8e-13</td>
<td class="org-right">0.0</td>
<td class="org-right">-82000.0</td>
<td class="org-right">0.0</td>
<td class="org-right">280000000.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
</tr>

<tr>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">-2600000.0</td>
<td class="org-right">6.5e-06</td>
<td class="org-right">82000.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">280000000.0</td>
<td class="org-right">1.7e-05</td>
</tr>

<tr>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">6.5e-06</td>
<td class="org-right">-610.0</td>
<td class="org-right">-9.2e-08</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">1.7e-05</td>
<td class="org-right">6100.0</td>
</tr>
</tbody>
</table>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 9:</span> First 10x10 elements of the Mass matrix</caption>

<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">0.016</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0082</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
</tr>

<tr>
<td class="org-right">0.0</td>
<td class="org-right">0.018</td>
<td class="org-right">0.0</td>
<td class="org-right">-5.3e-21</td>
<td class="org-right">0.0</td>
<td class="org-right">0.00016</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0064</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
</tr>

<tr>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.018</td>
<td class="org-right">-5.9e-15</td>
<td class="org-right">-0.00016</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0064</td>
<td class="org-right">-5.2e-15</td>
</tr>

<tr>
<td class="org-right">0.0</td>
<td class="org-right">-5.3e-21</td>
<td class="org-right">-5.9e-15</td>
<td class="org-right">2.7e-07</td>
<td class="org-right">7.7e-17</td>
<td class="org-right">-4.7e-23</td>
<td class="org-right">0.0</td>
<td class="org-right">-1.9e-21</td>
<td class="org-right">-5.2e-15</td>
<td class="org-right">1.4e-07</td>
</tr>

<tr>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">-0.00016</td>
<td class="org-right">7.7e-17</td>
<td class="org-right">1.9e-06</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">-9.8e-05</td>
<td class="org-right">7.2e-17</td>
</tr>

<tr>
<td class="org-right">0.0</td>
<td class="org-right">0.00016</td>
<td class="org-right">0.0</td>
<td class="org-right">-4.7e-23</td>
<td class="org-right">0.0</td>
<td class="org-right">1.9e-06</td>
<td class="org-right">0.0</td>
<td class="org-right">9.8e-05</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
</tr>

<tr>
<td class="org-right">0.0082</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.018</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
</tr>

<tr>
<td class="org-right">0.0</td>
<td class="org-right">0.0064</td>
<td class="org-right">0.0</td>
<td class="org-right">-1.9e-21</td>
<td class="org-right">0.0</td>
<td class="org-right">9.8e-05</td>
<td class="org-right">0.0</td>
<td class="org-right">0.02</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
</tr>

<tr>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0064</td>
<td class="org-right">-5.2e-15</td>
<td class="org-right">-9.8e-05</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.02</td>
<td class="org-right">-5.9e-15</td>
</tr>

<tr>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">-5.2e-15</td>
<td class="org-right">1.4e-07</td>
<td class="org-right">7.2e-17</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">0.0</td>
<td class="org-right">-5.9e-15</td>
<td class="org-right">3e-07</td>
</tr>
</tbody>
</table>

<p>
Using <code>K</code>, <code>M</code> and <code>int_xyz</code>, we can use the <code>Reduced Order Flexible Solid</code> simscape block.
</p>
</div>
</div>

<div id="outline-container-org2242317" class="outline-4">
<h4 id="org2242317"><span class="section-number-4">3.2.2</span> Identification of the Dynamics</h4>
<div class="outline-text-4" id="text-3-2-2">
<p>
The flexible element is imported using the <code>Reduced Order Flexible Solid</code> simscape block.
</p>

<p>
To model the actuator, an <code>Internal Force</code> block is added between the first and second nodes.
To model the sensors, a <code>Relative Motion Sensor</code> block is added between the second and the third nodes.
</p>

<p>
Two masses are fixed at the ends of the piezo-electric stack actuator.
</p>

<p>
We first set the mass to be zero.
</p>
<div class="org-src-container">
<pre class="src src-matlab">m = 0;
</pre>
</div>

<p>
The dynamics is identified from the applied force to the measured relative displacement.
</p>

<div class="org-src-container">
<pre class="src src-matlab">%% Name of the Simulink File
mdl = 'piezo_stack_sensor';

%% Input/Output definition
clear io; io_i = 1;
io(io_i) = linio([mdl, '/F'], 1, 'openinput');  io_i = io_i + 1;
io(io_i) = linio([mdl, '/x'], 1, 'openoutput'); io_i = io_i + 1;

Ga = linearize(mdl, io);
</pre>
</div>

<p>
Then, we add 1Kg of mass:
</p>
<div class="org-src-container">
<pre class="src src-matlab">m = 1;
</pre>
</div>

<p>
And the dynamics is identified.
</p>

<div id="org4443949" class="figure">
<p><img src="figs/piezo_stack_actuator_frf.png" alt="piezo_stack_actuator_frf.png" />
</p>
<p><span class="figure-number">Figure 14: </span>Identify transfer function from a vertical force applied at the middle point of the cantilever beam to its vertical displacement</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org32499e1" class="outline-3">
<h3 id="org32499e1"><span class="section-number-3">3.3</span> Comparison</h3>
</div>
</div>
<div id="outline-container-orgad1278b" class="outline-2">
<h2 id="orgad1278b"><span class="section-number-2">4</span> Functions</h2>
<div class="outline-text-2" id="text-4">
<p>
<a id="org8c2c166"></a>
</p>
</div>

<div id="outline-container-orgf813fe5" class="outline-3">
<h3 id="orgf813fe5"><span class="section-number-3">4.1</span> <code>extractMatrix</code>: Extract Mass/Stiffness matrices</h3>
<div class="outline-text-3" id="text-4-1">
<p>
<a id="orga298c16"></a>
</p>

<p>
This Matlab function is accessible <a href="src/extractMatrix.m">here</a>.
</p>
</div>

<div id="outline-container-orgba076c4" class="outline-4">
<h4 id="orgba076c4">Function description</h4>
<div class="outline-text-4" id="text-orgba076c4">
<div class="org-src-container">
<pre class="src src-matlab">function [M] = extractMatrix(filename)
% extractMatrix -
%
% Syntax: [M] = extractMatrix(filename)
%
% Inputs:
%    - filename - relative or absolute path of the file that contains the Matrix
%
% Outputs:
%    - M - Matrix that is contained in the file
</pre>
</div>
</div>
</div>

<div id="outline-container-orge943fed" class="outline-4">
<h4 id="orge943fed">Optional Parameters</h4>
<div class="outline-text-4" id="text-orge943fed">
<div class="org-src-container">
<pre class="src src-matlab">arguments
    filename
end
</pre>
</div>
</div>
</div>


<div id="outline-container-org410d920" class="outline-4">
<h4 id="org410d920">Read the file</h4>
<div class="outline-text-4" id="text-org410d920">
<div class="org-src-container">
<pre class="src src-matlab">str = fileread(filename);
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb3d0b23" class="outline-4">
<h4 id="orgb3d0b23">Extract the Matrix</h4>
<div class="outline-text-4" id="text-orgb3d0b23">
<div class="org-src-container">
<pre class="src src-matlab">str = regexprep(str,'\s+','');

parts = regexp(str, '\[(?&lt;row&gt;\d+),(?&lt;col&gt;\d+)\]:(?&lt;val&gt;[^\[]+)', 'names');
</pre>
</div>

<p>
Get the number of column and rows
</p>
<div class="org-src-container">
<pre class="src src-matlab">row = cellfun(@str2double, {parts.row}, 'UniformOutput', true);

col = cellfun(@str2double, {parts.col}, 'UniformOutput', true);
</pre>
</div>

<p>
Get the values of the matrix
</p>
<div class="org-src-container">
<pre class="src src-matlab">val = cellfun(@str2double, {parts.val}, 'UniformOutput', true);
</pre>
</div>

<p>
Get the size of the matrix
</p>
<div class="org-src-container">
<pre class="src src-matlab">sz = [max(row), max(col)];
</pre>
</div>

<p>
Create the Matrix with the correct size
</p>
<div class="org-src-container">
<pre class="src src-matlab">M = zeros(sz);
</pre>
</div>

<p>
Get matrix position corresponding to the values.
</p>
<div class="org-src-container">
<pre class="src src-matlab">ix = sub2ind(sz, row, col);
</pre>
</div>

<p>
Finally, data are assigned.
</p>
<div class="org-src-container">
<pre class="src src-matlab">M(ix)= val;
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgd8ab9e5" class="outline-3">
<h3 id="orgd8ab9e5"><span class="section-number-3">4.2</span> <code>extractNodes</code>: Extract Nodes positions and Interfaces DoFs</h3>
<div class="outline-text-3" id="text-4-2">
<p>
<a id="orgcf866f5"></a>
</p>

<p>
This Matlab function is accessible <a href="src/extractNodes.m">here</a>.
</p>
</div>

<div id="outline-container-orgf6af842" class="outline-4">
<h4 id="orgf6af842">Function description</h4>
<div class="outline-text-4" id="text-orgf6af842">
<div class="org-src-container">
<pre class="src src-matlab">function [int_xyz, int_i, n_xyz, n_i, nodes] = extractNodes(filename)
% extractNodes -
%
% Syntax: [n_xyz, nodes] = extractNodes(filename)
%
% Inputs:
%    - filename - relative or absolute path of the file that contains the Matrix
%
% Outputs:
%    - n_xyz -
%    - nodes - table containing the node numbers and corresponding dof of the interfaced DoFs
</pre>
</div>
</div>
</div>

<div id="outline-container-orga3a7ebd" class="outline-4">
<h4 id="orga3a7ebd">Optional Parameters</h4>
<div class="outline-text-4" id="text-orga3a7ebd">
<div class="org-src-container">
<pre class="src src-matlab">arguments
    filename
end
</pre>
</div>
</div>
</div>


<div id="outline-container-orgab0775d" class="outline-4">
<h4 id="orgab0775d">Read the file</h4>
<div class="outline-text-4" id="text-orgab0775d">
<div class="org-src-container">
<pre class="src src-matlab">fid = fopen(filename,'rt');

if fid == -1
    error('Error opening the file');
end
</pre>
</div>
</div>
</div>

<div id="outline-container-org345e246" class="outline-4">
<h4 id="org345e246">Extract Nodes</h4>
<div class="outline-text-4" id="text-org345e246">
<div class="org-src-container">
<pre class="src src-matlab">n_xyz = []; % Contains nodes coordinates
n_i = []; % Contains nodes indices

while 1
    % Read a line
    nextline = fgetl(fid);

    % End of the file
    if ~isstr(nextline), break, end

    % Line just before the list of nodes coordinates
    if contains(nextline, 'NODE') &amp;&amp; ...
            contains(nextline, 'X') &amp;&amp; ...
            contains(nextline, 'Y') &amp;&amp; ...
            contains(nextline, 'Z')

        while 1
            nextline = fgetl(fid);

            if nextline &lt; 0, break, end

            c = sscanf(nextline, ' %f');

            if isempty(c), break, end

            n_xyz = [n_xyz; c(2:4)'];
            n_i = [n_i; c(1)];
        end
    end

    if nextline &lt; 0, break, end

    % Line just before the list of node DOF
    if contains(nextline, 'NODE DOF')
        n_num = []; % Contains node numbers
        n_dof = {}; % Contains node directions

        while 1
            nextline = fgetl(fid);

            if nextline &lt; 0, break, end

            c = sscanf(nextline, ' %d %s');

            if isempty(c), break, end

            n_num = [n_num; c(1)];

            n_dof{length(n_dof)+1} = char(c(2:end)');
        end

        nodes = table(n_num, string(n_dof'), 'VariableNames', {'node_i', 'node_dof'});
    end

    if nextline &lt; 0, break, end
end
</pre>
</div>
</div>
</div>

<div id="outline-container-orga76d8e5" class="outline-4">
<h4 id="orga76d8e5">Close the file</h4>
<div class="outline-text-4" id="text-orga76d8e5">
<div class="org-src-container">
<pre class="src src-matlab">fclose(fid);
</pre>
</div>
</div>
</div>

<div id="outline-container-org5ff42b6" class="outline-4">
<h4 id="org5ff42b6">Get XYZ coordinates of the interface nodes</h4>
<div class="outline-text-4" id="text-org5ff42b6">
<div class="org-src-container">
<pre class="src src-matlab">int_i = unique(nodes.('node_i')); % indices of interface nodes

% Extract XYZ coordinates of only the interface nodes
int_xyz = n_xyz(logical(sum(n_i.*ones(1, length(int_i)) == int_i', 2)), :);
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org06bb2c4" class="outline-3">
<h3 id="org06bb2c4"><span class="section-number-3">4.3</span> <code>extractEigs</code>: Extract Eigen Values and Eigen Vectors</h3>
<div class="outline-text-3" id="text-4-3">
<p>
<a id="orgc13f880"></a>
</p>

<p>
This Matlab function is accessible <a href="src/extractEigs.m">here</a>.
</p>
</div>

<div id="outline-container-orgedfe9c7" class="outline-4">
<h4 id="orgedfe9c7">Function description</h4>
<div class="outline-text-4" id="text-orgedfe9c7">
<div class="org-src-container">
<pre class="src src-matlab">function [zm, w] = extractEigs(filename, args)
% extractEigs -
%
% Syntax: [zm, w] = extractEigs(filename, args)
%
% Inputs:
%    - filename - relative or absolute path of the file that contains the eigenvectors and eigenvalues
%    - args - Optional parameters:
%        - dirs - [6 x 1] - ones(6,1) (default)
%                          - Vectors with 0 and 1 identifying directions to include in the modal matrix
%                          - This corresponds to [Ux, Uy, Uz, Rx, Ry, Rz]
%        - soft - 'ansys' (default) - Software used for the FEM
%
% Outputs:
%    - zm - [(n x dofs) x m] - Modal Matrix containing the eigenvectors
%                            - zm(1:n, i) corresponds to the eigenvector for mode i and for first dir considered
%                            - zm((n-1)*j+1:n*j, i) corresponds to the eigenvector for i'th mode and for j'th dir considered
%    - w  - [m x 1] - Eigenvalues [Hz]
</pre>
</div>
</div>
</div>

<div id="outline-container-org8ea64e8" class="outline-4">
<h4 id="org8ea64e8">Optional Parameters</h4>
<div class="outline-text-4" id="text-org8ea64e8">
<div class="org-src-container">
<pre class="src src-matlab">arguments
    filename
    args.dirs (6,1) double {mustBeNumericOrLogical}            = ones(6,1)
    args.soft       char   {mustBeMember(args.soft,{'ansys'})} = 'ansys'
end
</pre>
</div>
</div>
</div>

<div id="outline-container-org33601e5" class="outline-4">
<h4 id="org33601e5">Open the file</h4>
<div class="outline-text-4" id="text-org33601e5">
<div class="org-src-container">
<pre class="src src-matlab">fid = fopen(filename,'rt');

if fid == -1
    error('Error opening the file');
end
</pre>
</div>
</div>
</div>

<div id="outline-container-orgec6ffd8" class="outline-4">
<h4 id="orgec6ffd8">Extract Eigenvalues - Ansys</h4>
<div class="outline-text-4" id="text-orgec6ffd8">
<div class="org-src-container">
<pre class="src src-matlab">if strcmp(args.soft, 'ansys')
    w = [];
    zm = [];

    while 1
        % Read a line
        nextline = fgetl(fid);

        % End of the file
        if ~isstr(nextline), break, end

        % Lines containing the mode numbers
        if contains(nextline, ' LOAD STEP=') &amp;&amp; ...
                contains(nextline, 'SUBSTEP=') &amp;&amp; ...
                ~contains(nextline, 'CUM')
            mode_num = sscanf(nextline, ' LOAD STEP= %*f  SUBSTEP= %f ');
        end

        % Lines containing the frequency of the modes
        if contains(nextline, 'FREQ=')
            w = [w, sscanf(nextline, ' FREQ= %f LOAD CASE= %*f')];
        end

        % Start of the eigenvectors
        if contains(nextline, 'ROTZ')
            zmi = [];

            % Read the eigenvectors for each of the nodes
            while 1
                nextline = fgetl(fid);
                c = sscanf(nextline, ' %f');
                if isempty(c), break, end
                zmi = [zmi; c(2:end)'];
            end

            zm (:, :, mode_num) = zmi;
        end
    end

    zm = reshape(zm(:, logical([0; args.dirs]), :), size(zm, 1)*sum(args.dirs), size(zm, 3));
end
</pre>
</div>
</div>
</div>

<div id="outline-container-org740ae11" class="outline-4">
<h4 id="org740ae11">Close the file</h4>
<div class="outline-text-4" id="text-org740ae11">
<div class="org-src-container">
<pre class="src src-matlab">fclose(fid);
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc35cf14" class="outline-3">
<h3 id="orgc35cf14"><span class="section-number-3">4.4</span> <code>normalizeEigs</code>: Normalize Eigen Vectors</h3>
<div class="outline-text-3" id="text-4-4">
<p>
<a id="orgbbb086b"></a>
</p>

<p>
This Matlab function is accessible <a href="src/normalizeEigs.m">here</a>.
</p>
</div>

<div id="outline-container-org2717179" class="outline-4">
<h4 id="org2717179">Function description</h4>
<div class="outline-text-4" id="text-org2717179">
<div class="org-src-container">
<pre class="src src-matlab">function [zn] = normalizeEigs(zm, args)
% normalizeEigs - Normalize the eigenvectors
%
% Syntax: [zn] = normalizeEigs(zm, args)
%
% Inputs:
%    - zm - Modal Matrix
%    - args - Optional parameters:
%        - method - 'mass' (default), 'unity' - Method used to normalize the eigenvectors
%
% Outputs:
%    - zn - Normalized Modal Matrix
</pre>
</div>
</div>
</div>

<div id="outline-container-org4b942e2" class="outline-4">
<h4 id="org4b942e2">Optional Parameters</h4>
<div class="outline-text-4" id="text-org4b942e2">
<div class="org-src-container">
<pre class="src src-matlab">arguments
    zm
    args.m      double {mustBeNumeric} = 0
    args.method char   {mustBeMember(args.method,{'mass', 'unity'})} = 'mass'
end
</pre>
</div>
</div>
</div>

<div id="outline-container-org555fc55" class="outline-4">
<h4 id="org555fc55">Normalize the Eigen Vectors - Mass Method</h4>
<div class="outline-text-4" id="text-org555fc55">
<div class="org-src-container">
<pre class="src src-matlab">if strcmp(args.method, 'mass')
    if size(args.m) ~= [size(zm,1), size(zm,1)]
        error('The provided Mass matrix has not a compatible size with the Modal Matrix')
    end

    zn = zeros(size(zm));
    for i = 1:size(zm,2)
        zn(:,i) = zm(:,i)/sqrt(zm(:,i)'*args.m*zm(:,i));
    end
end
</pre>
</div>
</div>
</div>

<div id="outline-container-org95c5fc4" class="outline-4">
<h4 id="org95c5fc4">Normalize the Eigen Vectors - Unity Method</h4>
<div class="outline-text-4" id="text-org95c5fc4">
<div class="org-src-container">
<pre class="src src-matlab">if strcmp(args.method, 'unity')
  zn = zm./max(zm);
end
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orge3def56" class="outline-3">
<h3 id="orge3def56"><span class="section-number-3">4.5</span> <code>reductionInOut</code>: Reduce the Modal matrix to some nodes</h3>
<div class="outline-text-3" id="text-4-5">
<p>
<a id="org19a014d"></a>
</p>

<p>
This Matlab function is accessible <a href="src/reductionInOut.m">here</a>.
</p>
</div>

<div id="outline-container-org847d6cc" class="outline-4">
<h4 id="org847d6cc">Function description</h4>
<div class="outline-text-4" id="text-org847d6cc">
<div class="org-src-container">
<pre class="src src-matlab">function [zr] = reductionInOut(zn, i_inputs, i_outputs)
% reductionInOut - Reduce the Modal Matrix to only specified nodes corresponding to Inputs and Ouputs
%
% Syntax: [zr] = reductionInOut(zn, i_inputs, i_outputs)
%
% Inputs:
%    - zn        - Normalized Modal Matrix
%    - i_inputs  - Node indices corresponding to inputs
%    - i_outputs - Node indices corresponding to inputs
%
% Outputs:
%    - zr - Reduced Normalized Modal Matrix
</pre>
</div>
</div>
</div>

<div id="outline-container-orge05c8f3" class="outline-4">
<h4 id="orge05c8f3">Arguments</h4>
<div class="outline-text-4" id="text-orge05c8f3">
<div class="org-src-container">
<pre class="src src-matlab">arguments
    zn
    i_inputs  {mustBeInteger} = 0
    i_outputs {mustBeInteger} = 0
end
</pre>
</div>
</div>
</div>

<div id="outline-container-org5d8c89f" class="outline-4">
<h4 id="org5d8c89f">Size Reduction</h4>
<div class="outline-text-4" id="text-org5d8c89f">
<div class="org-src-container">
<pre class="src src-matlab">zr = zn([i_inputs, i_outputs], :);
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org11526ea" class="outline-3">
<h3 id="org11526ea"><span class="section-number-3">4.6</span> <code>computeModalDamping</code> - Compute the Damping</h3>
<div class="outline-text-3" id="text-4-6">
<p>
<a id="orgbda7a8f"></a>
</p>

<p>
This Matlab function is accessible <a href="src/computeModalDaping.m">here</a>.
</p>
</div>

<div id="outline-container-orga87a578" class="outline-4">
<h4 id="orga87a578">Function description</h4>
<div class="outline-text-4" id="text-orga87a578">
<div class="org-src-container">
<pre class="src src-matlab">function [xi] = computeModalDaping(z, w, args)
% computeModalDaping -
%
% Syntax: [xi] = computeModalDaping(z, w, args)
%
% Inputs:
%    - z, w, args -
%
% Outputs:
%    - xi -
</pre>
</div>
</div>
</div>

<div id="outline-container-org0903454" class="outline-4">
<h4 id="org0903454">Arguments</h4>
<div class="outline-text-4" id="text-org0903454">
<div class="org-src-container">
<pre class="src src-matlab">arguments
end
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-orgc3d6d78" class="outline-3">
<h3 id="orgc3d6d78"><span class="section-number-3">4.7</span> <code>sortModes</code> - Sort Modes</h3>
<div class="outline-text-3" id="text-4-7">
<p>
<a id="org585010b"></a>
</p>

<p>
This Matlab function is accessible <a href="src/sortModes.m">here</a>.
</p>
</div>

<div id="outline-container-orgcc33983" class="outline-4">
<h4 id="orgcc33983">Function description</h4>
<div class="outline-text-4" id="text-orgcc33983">
<div class="org-src-container">
<pre class="src src-matlab">function [modes_i] = sortModes(z, w, xi, args)
% sortModes -
%
% Syntax: [modes_i] = sortModes(z, w, xi, args)
%
% Inputs:
%    - z, w, xi, args -
%
% Outputs:
%    - modes_i -

end
</pre>
</div>
</div>
</div>

<div id="outline-container-org4a28ba6" class="outline-4">
<h4 id="org4a28ba6">Arguments</h4>
<div class="outline-text-4" id="text-org4a28ba6">
<div class="org-src-container">
<pre class="src src-matlab">arguments
end
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-orgeb5d867" class="outline-3">
<h3 id="orgeb5d867"><span class="section-number-3">4.8</span> <code>reduceModes</code> - Get Modes numbers for the reduced model</h3>
<div class="outline-text-3" id="text-4-8">
<p>
<a id="org6210c8d"></a>
</p>

<p>
This Matlab function is accessible <a href="src/reduceModes.m">here</a>.
</p>
</div>

<div id="outline-container-org81ee148" class="outline-4">
<h4 id="org81ee148">Function description</h4>
<div class="outline-text-4" id="text-org81ee148">
<div class="org-src-container">
<pre class="src src-matlab">function [modes_i] = reduceModes(z, w, xi, args)
% reduceModes -
%
% Syntax: [modes_i] = reduceModes(z, w, xi, args)
%
% Inputs:
%    - z, w, xi, args -
%
% Outputs:
%    - modes_i -
</pre>
</div>
</div>
</div>

<div id="outline-container-org8e7aa47" class="outline-4">
<h4 id="org8e7aa47">Arguments</h4>
<div class="outline-text-4" id="text-org8e7aa47">
<div class="org-src-container">
<pre class="src src-matlab">arguments
end
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-org43899b2" class="outline-3">
<h3 id="org43899b2"><span class="section-number-3">4.9</span> <code>createStateSpaceModel</code> - Create the Reduced State Space Model</h3>
<div class="outline-text-3" id="text-4-9">
<p>
<a id="orgc605a07"></a>
</p>

<p>
This Matlab function is accessible <a href="src/createStateSpaceModel.m">here</a>.
</p>
</div>

<div id="outline-container-org713e6f9" class="outline-4">
<h4 id="org713e6f9">Function description</h4>
<div class="outline-text-4" id="text-org713e6f9">
<div class="org-src-container">
<pre class="src src-matlab">function [G] = createStateSpaceModel(z, w, xi, modes_i)
% createStateSpaceModel -
%
% Syntax: [G] = createStateSpaceModel(z, w, xi, modes_i)
%
% Inputs:
%    - z, w, xi, modes_i -
%
% Outputs:
%    - G -
</pre>
</div>
</div>
</div>

<div id="outline-container-org4586188" class="outline-4">
<h4 id="org4586188">Arguments</h4>
<div class="outline-text-4" id="text-org4586188">
<div class="org-src-container">
<pre class="src src-matlab">arguments
end
</pre>
</div>
</div>
</div>
</div>
</div>

<p>

<h1 class='org-ref-bib-h1'>Bibliography</h1>
<ul class='org-ref-bib'><li><a id="hatch00_vibrat_matlab_ansys">[hatch00_vibrat_matlab_ansys]</a> <a name="hatch00_vibrat_matlab_ansys"></a>Hatch, Vibration simulation using MATLAB and ANSYS, CRC Press (2000).</li>
</ul>
</p>
</div>
<div id="postamble" class="status">
<p class="author">Author: Dehaeze Thomas</p>
<p class="date">Created: 2020-06-05 ven. 15:47</p>
</div>
</body>
</html>
